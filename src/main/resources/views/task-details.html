<!DOCTYPE html>
<html lang="en" th:replace="~{layout :: layout(
    title = 'Task details',
    content = ~{::section}
)}" xmlns:th="http://www.thymeleaf.org">
    <body>
        <section>
            <div class="container">
                <h1 th:text="${task.name}">Task Details</h1>
                <div class="d-flex pb-2">
                    <a th:href="@{/tasks/{id}/edit(id=${task.id})}" class="btn btn-outline-primary">Edit</a>
                    <form action="#" th:action="@{/tasks/{id}/delete(id=${task.id})}" method="post" onsubmit="disableSubmitButtons()" class="mx-4">
                        <input class="btn btn-outline-primary" type="button" value="Delete" onclick="showDeletePrompt()" />
                        <span id="delete-prompt" class="visually-hidden">
                            <span>Are you sure?</span>
                            <input th:replace="~{fragments/disabling-submit :: disabling-submit('Yes!')}" />
                        </span>
                    </form>
                </div>

                <div class="list-group">

                    <div class="list-group-item">
                        <div class="text-secondary">Next due date</div>
                        <div th:if="${task.dueDate != null}" th:text="${task.dueDate}"></div>
                        <div th:if="${task.dueDate == null}">Never</div>
                    </div>

                    <div class="list-group-item">
                        <div class="text-secondary">Trigger</div>
                        <div th:text="${task.trigger.friendlyString}"></div>
                        <div th:if="${task.trigger.note != null}"
                             class="text-secondary"
                             th:text="|Note: ${task.trigger.note}|"></div>
                    </div>

                    <div class="list-group-item">
                        <div class="text-secondary">Autocomplete</div>
                        <div th:text="${task.autocomplete ? 'Yes' : 'No'}"></div>
                    </div>

                    <div class="list-group-item">
                        <div class="text-secondary">Created</div>
                        <div th:text="${task.createdTimestamp}"></div>
                    </div>

                    <div class="list-group-item">
                        <div class="text-secondary">Updated</div>
                        <div th:text="${task.updatedTimestamp}"></div>
                    </div>

                    <div class="list-group-item">
                        <div class="text-secondary">Description</div>
                        <div id="hidden-description" th:text="${task.description}" class="visually-hidden"></div>
                        <div th:if="${task.description != null && !task.description.isBlank()}" id="markdown-description"></div>
                        <div th:if="${task.description == null || task.description.isBlank()}">None</div>
                    </div>

                </div>

                <script src="https://cdn.jsdelivr.net/npm/marked@11.0.0/lib/marked.umd.min.js"></script>
                <script type="text/javascript">
                    function showDeletePrompt() {
                        document.getElementById("delete-prompt").classList.remove("visually-hidden")
                    }

                    const markdownSource = document.getElementById("hidden-description").innerHTML
                    if (markdownSource) {
                        document.getElementById("markdown-description").innerHTML = marked.parse(markdownSource)
                    }
                </script>
            </div>
        </section>
    </body>
</html>